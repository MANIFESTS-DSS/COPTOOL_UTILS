## COPTool_Utils: ALOHA2COP & MOHID2COP

**COPTool_Utils** is a suite of ETL (Extract, Transform, Load) tools designed to bridge the gap between hazard modeling and operational decision-making. It automates the ingestion of atmospheric and marine pollution results into a **Common Operational Picture (COP)** database. 

---

## üá™üá∫ Project Context: MANIFESTS-Genius

This software is developed under the framework of the **MANIFESTS-Genius** project:
> *From Gases and Evaporators risk assessmeNt towards an Integrated management of sea and land pollUtion incidentS.* 

**Acknowledgment:** The work described in this report was supported by the **Directorate-General for European Civil Protection and Humanitarian Aid Operations (DG-ECHO)** of the European Union through the Grant Agreement number **101140390 - MANIFESTS Genius ‚Äì UCPM-2023-KAPP** corresponding to the Call objective ‚ÄúKnowledge for Action in Prevention and Preparedness‚Äù. 

**Partners:** Developed in cooperation with **INTECMAR** and **IST**, coordinated by **Cedre**. 

---

## üõ† Functional Overview

The suite currently supports two main modeling ingestion workflows:

### 1. ALOHA2COP
* **Extraction:** Parses KML files from NOAA's ALOHA model. 
* **Transformation:** Identifies threat levels (AEGL, PAC, LEL, IDLH) and converts coordinates into **Shapely** geometries. 

### 2. MOHID2COP
* **Extraction:** Reads Lagrangian outputs from MOHID in **HDF5** or **NetCDF** formats. 
* **Transformation:** Uses the **Marching Squares algorithm** to extract isolines from concentration fields and generates WKT (Well-Known Text) polygons. 
* **Loading:** Ingests the resulting spatial data into a PostgreSQL/PostGIS database. 

---

## üöÄ Installation & Setup

### 1. Requirements
Install the necessary dependencies using the `requirements.txt` file:
```bash
pip install -r requirements.txt
```

Key dependencies: `fastkml`, `shapely`, `psycopg2-binary`, `scikit-image`, `h5py`, `netCDF4`, and `lxml`.*

### 2. Database Configuration
The system uses a shared configuration file to connect to the database.

* **File:** `config/db_aloha2cop.json`.
* **Action:** Configure your host, user, and password using the provided template. 
* **Requirement:** The database must have the **PostGIS** extension enabled to handle spatial geometries.

### 3. Execution Parameters
Each tool is controlled via its own JSON configuration:

* **ALOHA:** `tools/aloha2cop/aloha2cop.json` 
* **Key Fields:** * `file_in`: Path to the input KML file generated by ALOHA.
    * `campaign`: Metadata for grouping simulations and assigning descriptions in the database.
    * `initial date`: Simulation start time in `YYYY-MM-DD HH:MM:SS` format.
  
* **MOHID:** `tools/mohid2cop/mohid2cop.json`

---

## üìÇ Project Structure
Based on the `COPTool_Utils` workspace:

* **`requirements.txt`**: Global Python dependencies. 
* **`LICENSE`**: Full text of the EUPL v1.2. 
* **`config/`**: Shared database connection settings. 
* **`common/`**: Internal readers (HDF5, NetCDF, JSON) and SQL utilities. 
* **`tools/`**:
    * **`aloha2cop/`**: Scripts for ALOHA KML ingestion. 
    * **`mohid2cop/`**: Scripts for MOHID HDF5/NetCDF ingestion. 

---

## ‚öñÔ∏è License & Disclaimer

### License
This project is licensed under the **European Union Public Licence (EUPL) v1.2**.

### Disclaimer
The content of this document represents the views of the author only and is his/her sole responsibility; it cannot be considered to reflect the views of the European Commission and/or the Directorate-General for European Civil Protection and Humanitarian Aid Operations (DG-ECHO) or any other body of the European Union.

---

**Author:** Pedro Montero / INTECMAR 
**Version:** 1.1.0 
**Date:** 2026-02-16

---

![Alt text](UEpequeno.png)

