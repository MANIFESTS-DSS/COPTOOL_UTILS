# ALOHA2COP

**ALOHA2COP** is a specialized ETL (Extract, Transform, Load) tool designed to bridge the gap between hazard modeling and operational decision-making. It automates the ingestion of atmospheric dispersion results from NOAA's **ALOHA** model into a **Common Operational Picture (COP)** database.

---

## üá™üá∫ Project Context: MANIFESTS-Genius

This software is developed under the framework of the **MANIFESTS-Genius** project:
> *From Gases and Evaporators risk assessmeNt towards an Integrated management of sea and land pollUtion incidentS.*

**Acknowledgment:** The work described in this report was supported by the **Directorate-General for European Civil Protection and Humanitarian Aid Operations (DG-ECHO)** of the European Union through the Grant Agreement number **101140390 - MANIFESTS Genius ‚Äì UCPM-2023-KAPP** corresponding to the Call objective ‚ÄúKnowledge for Action in Prevention and Preparedness‚Äù.

**Partners:** Developed in cooperation with **INTECMAR** and **IST**, coordinated by **Cedre**.

---

## üõ† Functional Overview

The program performs the following operations:
1.  **Extraction:** Parses KML files generated by the ALOHA model, specifically targeting the "Aloha Threat Zones" folder.
2.  **Transformation:** Identifies threat levels (AEGL, PAC, LEL, or IDLH), classifies hazards (Toxic/Flammable), and converts KML coordinates into **Shapely** geometries.
3.  **Loading:** Ingests the processed spatial data and metadata into a PostgreSQL/PostGIS database via the `AlohaQuery` class.

---

## üöÄ Installation & Setup

### 1. Requirements
Install the necessary dependencies using the `requirements.txt` file located in the root directory:
```bash
pip install -r requirements.txt
```
*Dependencies include: `fastkml`, `shapely`, `psycopg2-binary`, and `lxml`.*

### 2. Database Configuration
The system uses a configuration file to connect to the database.

* **Location:** `config/db_aloha2cop.json`.
* **Action:** Use `config/db_aloha2cop_example.json` as a template and fill in your host, user, and password.
* **Important:** Ensure the target database has the **PostGIS** extension enabled to handle spatial geometries.

### 3. Execution Parameters
The tool is controlled via a JSON input file defined in the main orchestrator.

* **File:** `tools/aloha2cop/aloha2cop.json`.
* **Key Fields:** * `file_in`: Path to the input KML file generated by ALOHA.
    * `campaign`: Metadata for grouping simulations and assigning descriptions in the database.
    * `initial date`: Simulation start time in `YYYY-MM-DD HH:MM:SS` format.

---

## üìÇ Project Structure
Based on the `COPTool_Utils` workspace:

* **`requirements.txt`**: Python dependencies needed for KML parsing and SQL ingestion.
* **`LICENSE`**: Full text of the EUPL v1.2.
* **`config/`**: Database connection settings and example templates.
* **`data/samples/`**: Example KML files from ALOHA simulations used for testing.
* **`tools/aloha2cop/`**:
    * `aloha2cop.py`: Main orchestrator that manages the ETL flow.
    * `aloha_reader.py`: Logic for parsing ALOHA KML folders and extracting coordinates into Shapely polygons.
    * `aloha_sql.py`: Database query layer for inserting campaign, simulation, and threat zone data.

---

## ‚öñÔ∏è License & Disclaimer

### License
This project is licensed under the **European Union Public Licence (EUPL) v1.2**. See the `LICENSE` file for the full legal text.

### Disclaimer
The content of this document represents the views of the author only and is his/her sole responsibility; it cannot be considered to reflect the views of the European Commission and/or the Directorate-General for European Civil Protection and Humanitarian Aid Operations (DG-ECHO) or any other body of the European Union. The European Commission and the DG-ECHO is not responsible for any use that may be made of the information it contains.

---

